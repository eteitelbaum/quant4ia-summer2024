{
  "hash": "d82ae058d598bacf2ef8e11f775eba29",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Hypothesis Testing \ndate: today\ndate-format: long\nfooter: \"[IAFF 6501 Website](https://quant4ia.rocks/)\"\nlogo: images/iaff6501-logo.png\nformat:\n  revealjs:\n    theme: [simple, custom.scss]\n    transition: fade\n    slide-number: true\n    #multiplex: true\n    chalkboard: true\nexecute:\n  echo: false\n  message: false\n  warning: false\n  freeze: auto\n---\n\n\n# Hypothesis Test for a Single Proportion\n\n## Jobs Training Programs\n\n-   International development organizations are sometimes interested in providing training to people in order to help them find a job\n-   Imagine the unemployment rate in a low-income country is 30%\n-   One organization claims that its jobs training program is a success because only 15 of the 60 people that they trained did not have a job (25% unemployment rate)\n-   What should we think about this claim? Is this a successful program?\n\n## Today's Code\n\n<https://www.dropbox.com/scl/fo/g4tdpdwcij78nyydvr4bp/h?rlkey=hctskhle6222csnwre5ir9gz3&dl=0>\n\n## \n\n<br>\n\nNow let's create some data to match our hypothetical example.\n\n<br>\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n\njobs_program <- tibble(\n  outcome = c(rep(\"unemployed\", 15), rep(\"employed\", 45))\n)\n```\n:::\n\n\n## \n\n<br>\n\nUse the base R `head()` function to see the first five rows.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(jobs_program)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 1\n  outcome   \n  <chr>     \n1 unemployed\n2 unemployed\n3 unemployed\n4 unemployed\n5 unemployed\n6 unemployed\n```\n\n\n:::\n:::\n\n\n## \n\n<br>\n\nUse the `tail()` function to see the last five rows.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntail(jobs_program)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 1\n  outcome \n  <chr>   \n1 employed\n2 employed\n3 employed\n4 employed\n5 employed\n6 employed\n```\n\n\n:::\n:::\n\n\n## \n\n<br>\n\nNow let's visualize it with a bar chart.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](week-7.1_files/figure-revealjs/unnamed-chunk-4-1.png){width=960}\n:::\n:::\n\n\n## Question\n\n<br>\n\nIs it possible to assess this hypothetical organization's claim using the data and information presented thus far?\n\n>\"Our jobs program is a success because only 15 of the 60 people that we trained did not have a job. Thus our 25% unemployment rate beats the country's unemployment rate of 30%.\"\n\n## Correlation vs. causation\n\n<br>\n\n-   No.\n- We need to know more about how people were selected for the program in order to assess causality (e.g., were they randomly assigned?)\n-   But, we can still ask whether the unemployment rate of $\\hat{p}$ = 0.25 could be due to chance.\n\n## Hypothesis Testing Intuition {.smaller}\n\n<br>\n\n- We are going to assume \"nothing is going on\"\n    - In this case, the jobs program had no impact\n\n. . .\n\n- We are going to figure out what the distribution of outcomes we we might observe could be if nothing is going on\n    - In this case: if we take a sample of 60 from a population where the parameter is 0.3\n\n. . .\n\n- We will assess how likely we would be to observe our data if nothing is going on\n    - If very unlikely, we conclude that something is probably going on\n\n## Stating our Hypotheses\n\n<br>\n\n**Null hypothesis ($H_0$):** \"There is nothing going on.\"\n\n> Unemployment rate among those in the jobs program is no different than the country average of 30%.\n\n. . .\n\n**Alternative hypothesis ($H_A$):** \"There is something going on.\"\n\n> Unemployment rate is **lower** than the country average of 30%.\n\n\n## Hypothesis Test\n\n<br>\n\n::: incremental\n- **Hypothesis test:** If the null hypothesis were true, is the data we have in our sample likely to have been generated by chance (due to random variability)?\n- If yes, we do NOT reject the null hypothesis\n- If not very likely, we reject the null hypothesis \n:::\n\n## Hypothesis Testing Framework \n\n::: incremental\n-   Start with null hypothesis, $H_0$, represents the status quo\n-   Set an alternative hypothesis, $H_A$, that represents the research question, i.e. what we're testing for\n-   Conduct a hypothesis test under the assumption that the null hypothesis is true \n    -   if the test results suggest that the data do not provide convincing evidence for the alternative hypothesis, stick with the null hypothesis\n    -   if they do, then reject the null hypothesis in favor of the alternative\n:::\n\n## p-values and Critical Values\n\n<br>\n\n::: incremental\n- A **p-value** is the probability of observed or more extreme outcome given that the null hypothesis is true\n- A critical value ($\\alpha$) is the threshold at which we will reject the null hypothesis\n- If the p-value is less than $\\alpha$, we reject the null hypothesis\n- A standard threshold for $\\alpha$ is 0.05\n:::\n\n## The Null Distribution\n\n<br>\n\n-   Since $H_0: p = 0.30$, we need to simulate a null distribution where the probability of success (unemployment) for each trial (person in program) is 0.30\n\n. . .\n\n-   We want to know how likely we would be to get an unemployment rate of 0.25 in our sample of 60, *if the true unemployment rate were 0.30*\n\n\n## What do we expect?\n\n<br>\n\n::: incremental\n- So the first step is to simulate our null distribution\n- And the question is, when sampling from the null distribution, what is the expected proportion of unemployed?\n- We set up our simulator to select samples of 60 individuals with a 30% chance of being unemployed\n- We then calculate the proportion of unemployed in each sample\n:::\n\n## Simulation #1\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nsim1\n  employed unemployed \n        42         18 \n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.3\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](week-7.1_files/figure-revealjs/unnamed-chunk-5-1.png){width=50%}\n:::\n:::\n\n\n------------------------------------------------------------------------\n\n## Simulation #2\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nsim2\n  employed unemployed \n        41         19 \n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.3166667\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](week-7.1_files/figure-revealjs/unnamed-chunk-6-1.png){width=50%}\n:::\n:::\n\n\n## Simulation #3\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nsim3\n  employed unemployed \n        38         22 \n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.3666667\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](week-7.1_files/figure-revealjs/unnamed-chunk-7-1.png){width=50%}\n:::\n:::\n\n\n## We need to do this many times...\n\n## `tidymodels`\n\n<br>\n\nWe can use the `tidymodels` package to help with this process...\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#load tidymodels\nlibrary(tidymodels)\n\n# simulate the distribution\nnull_dist <- jobs_program |>\n  specify(response = outcome, success = \"unemployed\") |>\n  hypothesize(null = \"point\", p = c(\"unemployed\" = 0.30, \"employed\" = 0.70)) |>\n  generate(reps = 2000, type = \"draw\") |> \n  calculate(stat = \"prop\")\n```\n:::\n\n\n## What is being stored in *null_dist*?\n\n<br>\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nResponse: outcome (factor)\nNull Hypothesis: point\n# A tibble: 2,000 × 2\n   replicate  stat\n       <dbl> <dbl>\n 1         1 0.367\n 2         2 0.2  \n 3         3 0.283\n 4         4 0.2  \n 5         5 0.4  \n 6         6 0.317\n 7         7 0.3  \n 8         8 0.333\n 9         9 0.283\n10        10 0.25 \n# ℹ 1,990 more rows\n```\n\n\n:::\n:::\n\n\n## The null distribution\n\n<br>\n\nWhere should this distribution be centered?  Or, what should the mean be?\n\n<br>\n\n. . .\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnull_dist |>\n  summarize(mean = mean(stat))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 1\n   mean\n  <dbl>\n1 0.301\n```\n\n\n:::\n:::\n\n\n## Visualizing the null distribution\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](week-7.1_files/figure-revealjs/unnamed-chunk-11-1.png){width=40%}\n:::\n:::\n\n\n## Calculate the p-value\n\n<br> \n*p-value*--in what % of the simulations was the simulated sample proportion at least as extreme as the observed sample proportion?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnull_dist |>\n  # select out the value in the null distribution that are less that 0.25\n  filter(stat <= (15/60)) |>\n  # calculate the proportion - (number less divided by all values in null_dist)\n  summarise(p_value = n()/nrow(null_dist))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 1\n  p_value\n    <dbl>\n1   0.238\n```\n\n\n:::\n:::\n\n\n## Visualizing the p-value\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](week-7.1_files/figure-revealjs/unnamed-chunk-13-1.png){width=50%}\n:::\n:::\n\n\n## \"Significance\" level {.smaller}\n\n<br>\n\n::: incremental\n- Conventionally, people use a p-value of *0.05* as a cutoff (\"signifigance level\") for determining \"statistical significance\"\n    - That is, whether the null hypothesis should be rejected\n    - That is, whether the data we gathered is very unlikely to have been generated due to chance\n- Always remember that this is a convention\n    - *p=0.049* is under the cutoff, while p=0.051 is not: are these really different?\n- When people report \"statistically significant\" results, they mean that the p-value from their analysis is less than 0.05\n:::\n\n## Our Hypothetical Study\n\n<br>\n\n- Our finding: if the true unemployment rate were 30 percent and we draw samples of 60, about 23 percent of the time we will get an unemployment rate lower than the one among the participants in the program (simply due to random chance)\n- What should we conclude?\n\n## Conclusion\n\n<br>\n\n- We do NOT reject the null hypothesis: the unemployment rate in the sample could likely have been due to chance\n\n## Your Turn!\n\n- What if the unemployment rate for the program was only 10%?     - Would you reject the null hypothesis in this case?\n    - Demonstrate by calculating the p-value\n- Try changing the true unemployment rate in the null distribution to 0.50 (50%)\n  - Simulate the null distribution\n  - Would you reject the null hypothesis if the observed unemployment rate was 23% in this case?\n\n# Associations Between Two Variables\n\n## Hypotheses\n\n<br>\n\n- **Null hypothesis:** there is no relationship between treatment and outcome, the difference is due to chance\n- **Alternative hypothesis:** there is a relationship, the difference is not due to chance\n\n## Approach\n\n<br>\n\n- Under the null hypothesis, treatment has **NO** impact on *y* (the outcome)\n- This means that if we were to change the values of the treatment variable, the values on *y* **would stay the same**\n\n## Approach\n\n- So...we can simulate the null distribution by:\n    - Reshuffling the treatment variable\n    - Calculating the treatment effect\n    - Repeating many times\n    \n. . . \n\n- Then we can ask: how likely would we be to observe the treatment effect in our data, *if there is no effect of the treatment*?\n\n## Résumé Experiment Example\n\nBertrand and Mullainathan studied racial discrimination in responses to job applications in Chicago and Boston. They sent 4,870 résumés, randomly assigning names associated with different racial groups.\n- Data are in `openintro` package as an object called `resume`\n- I will save as `myDat`\n\n\n::: {.cell}\n\n:::\n\n\n## Callbacks by Race\n\n<br>\n\nRemember, race of applicant is randomly assigned.\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 2\n  race   calls\n  <chr>  <dbl>\n1 black 0.0645\n2 white 0.0965\n```\n\n\n:::\n:::\n\n\n##\n\n<br> \n\nLet's save the means for white and black applicants.\n\n<br>\n\n\n::: {.cell}\n\n:::\n\n\n##\n\n<br>\n\nAnd calculate the treatment effect. The treatment effect is the difference in means.\n\n<br>\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.03203285\n```\n\n\n:::\n:::\n\n\n## {.center}\n\nBefore formal tests, let's look at the data--the estimates **and** the confidence intervals...\n\n##\n\n<br>\n\nFirst, let's make the CIs for the white applicants.\n\n<br>\n\n\n::: {.cell}\n\n:::\n\n\n## \n\n<br>\n\nNow, let's create the CIs for black applicants.\n\n<br>\n\n\n::: {.cell}\n\n:::\n\n\n## \n\n<br>\n\nNow, let's tidy the data for plotting.\n\n<br>\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 4\n  race  meanCalls lower95 upper95\n  <chr>     <dbl>   <dbl>   <dbl>\n1 Black    0.0645  0.0550  0.0743\n2 White    0.0965  0.0850  0.108 \n```\n\n\n:::\n:::\n\n\n## Plot\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](week-7.1_files/figure-revealjs/unnamed-chunk-21-1.png){width=960}\n:::\n:::\n\n\n## Plot\n\n<br>\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(plotData, aes(y = meanCalls, x = race, ymin = lower95, ymax = upper95)) +\n  geom_col(fill = \"steelblue4\") +\n  geom_errorbar(width = .05) +\n  theme_bw()  +\n  ylim(0, .15) +\n  labs(x = \"Race of Applicant\",\n       y = \"Call Back Rate\")\n```\n:::\n\n\n## Is this evidence of racial discrimination?\n\n<br>\n\n- What is the null hypothesis?\n\n. . .\n\n- What is the alternative hypothesis?\n\n. . .\n\n- How can we formally test the null hypothesis to decide whether to reject it?\n\n## Formal Hypothesis Test\n\n<br>\n\n::: incremental\n- Calculate the difference in means (White - Black)\n- Shuffle the race variable\n- Calculate the difference in means for the shuffled data\n- Repeat many times\n- Simulates the null distribution of **differences** in callbacks\n:::\n\n## Hypothetical Original Data \n\n<br>\n\n| Applicant | Race  | Callback |\n|-----------|-------|----------|\n| A         | Black | Yes      |\n| B         | Black | No       |\n| C         | Black | No       |\n| D         | White | Yes      |\n| E         | White | No       |\n| F         | White | No       |\n\n## Step 1: Calculate Original Difference in Callback Rates\n\n<br> \n\n- **Objective:** Understand initial association between race and callback rates\n\n## Step 2: Shuffle (Permute) the Race Variable\n\n<br>\n\n- **Method:** Randomly reassign race labels, keeping callback outcomes fixed\n\n## Hypothetical Shuffled Data\n\n<br>\n\n| Applicant | Race (Shuffled) | Callback |\n|-----------|-----------------|----------|\n| A         | White           | Yes      |\n| B         | Black           | No       |\n| C         | White           | No       |\n| D         | White           | Yes      |\n| E         | Black           | No       |\n| F         | Black           | No       |\n\n## Step 3: Calculate Difference in Callback Rates Again\n\n<br> \n\n- **After Shuffling:** Calculate the difference in callback rates between Black and White groups\n- **Purpose:** Determine if observed difference is due to chance\n\n## Repeat Many Times\n\n<br>\n\n- Repeat shuffling 5000 times to generate a distribution of differences by chance\n- **Test:** Compare observed difference to null distribution to assess effect of race on callbacks\n- If observed difference is extreme (p-value is low), reject the null hypothesis\n\n## Simulating with `tidymodels`\n\n<br>\n\nIn real life we are going to use the `tidymodels` package to do the simulation for us.\n\n\n::: {.cell}\n\n:::\n\n\n## Visualize\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](week-7.1_files/figure-revealjs/unnamed-chunk-24-1.png){width=960}\n:::\n:::\n\n\n## Visualize\n\n<br>\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = null_dist, mapping = aes(x = stat)) +\n  geom_histogram(binwidth = 0.01, fill = \"steelblue4\") +\n  labs(title = \"Null distribution + Estimate\",\n       x = \"Estimated Difference under the Null\") +     \n  geom_vline(xintercept = teffect, linetype=\"dotted\", \n                color = \"black\", size=1) + theme_bw()\n```\n:::\n\n\n## Calculate the p-value\n\n<br>\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 1\n  p_value\n    <dbl>\n1       0\n```\n\n\n:::\n:::\n\n\n## What should we conclude?\n\n<br>\n\n::: incremental\n- The p-value is very small (below .05 threshold)\n- Therefore, we **reject** the null hypothesis: the racial gap is extremely unlikely to have occurred due to chance alone\n- This is evidence of racial discrimination\n:::\n\n## Your Turn! {.smaller}\n\n<br>\n\n- Use the **gender** variable in the `resume` data to assess whether there is gender discrimination in call backs\n- Plot means and 95% confidence intervals for the call back rate for men and women\n- Write the null and alternative hypotheses\n- Simulate the null distribution\n- Visualize the null distribution and the gender gap\n- Calculate the p-value\n- What do you conclude from your test?  \n\n\n",
    "supporting": [
      "week-7.1_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
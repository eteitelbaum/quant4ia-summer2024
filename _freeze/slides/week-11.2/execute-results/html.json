{
  "hash": "98ded62a7ab85539bd6635b1891cf58f",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Regression Tables\nsubtitle: How to Interpret and Create\ndate: today\ndate-format: long\nfooter: \"[IAFF 6501 Website](https://quant4ia.rocks/)\"\nlogo: images/iaff6501-logo.png\nformat:\n  revealjs:\n    theme: [simple, custom.scss]\n    transition: fade\n    slide-number: true\n    #multiplex: true\n    chalkboard: true\nexecute:\n  echo: false\n  message: false\n  warning: false\n  freeze: auto\n---\n\n::: {.cell}\n\n:::\n\n\n# Multiple Logistic Regression\n\n## Multiple Logistic Regression\n\n<br>\n\n::: {.incremental}\n- Just as with linear models, we can also run multiple logistic regressions\n- We can include multiple predictors in the model\n- Usually we want to include our main predictor of interest and control variables\n- The interpetation of the coefficients is the same as in the bivariate models\n:::\n\n## \n\n<br>\n\nDownload the data using the `peacesciencer` package if you haven't already...\n\n<br>\n\n\n::: {.cell}\n\n```{.r .cell-code}\nconflict_df <- create_stateyears(system = 'gw') |>\n  filter(year %in% c(1946:1999)) |>\n  add_ucdp_acd(type=c(\"intrastate\"), only_wars = FALSE) |>\n  add_democracy() |>\n  add_creg_fractionalization() |>\n  add_sdp_gdp() |>\n  add_rugged_terrain()\n```\n:::\n\n\n## \n\n<br>\n\nExample, including multiple predictors associated with conflict:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nconflict_model <- logistic_reg() |>\n  set_engine(\"glm\") |>\n  fit(factor(ucdponset) ~ ethfrac + relfrac + v2x_polyarchy + \n                          rugged + wbgdppc2011est + wbpopest,\n                  data= conflict_df,\n                  family = \"binomial\")\n\ntidy(conflict_model)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 7 × 5\n  term           estimate std.error statistic   p.value\n  <chr>             <dbl>     <dbl>     <dbl>     <dbl>\n1 (Intercept)     -5.69      1.41      -4.04  0.0000527\n2 ethfrac          0.800     0.381      2.10  0.0356   \n3 relfrac         -0.391     0.417     -0.939 0.348    \n4 v2x_polyarchy   -0.602     0.509     -1.18  0.237    \n5 rugged           0.0641    0.0760     0.843 0.399    \n6 wbgdppc2011est  -0.372     0.121     -3.08  0.00204  \n7 wbpopest         0.293     0.0673     4.35  0.0000134\n```\n\n\n:::\n:::\n\n\n## Predicted Probabilities\n\n<br>\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\n# load the \nlibrary(marginaleffects)\n\n# seledct some countries for a given year\nselected_countries <- conflict_df |>\n  filter(\n    statename %in% c(\"United States of America\", \"Venezuela\", \"Rwanda\"),\n    year == 1999)\n\n# extract the model\nconflict_fit <- conflict_model$fit\n\n# calculate margins for the subset\nmarg_effects <- predictions(conflict_fit, newdata = selected_countries)\n\n# tidy the results\ntidy(marg_effects) |>\n  select(estimate, p.value, conf.low, conf.high, statename)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 × 5\n  estimate  p.value conf.low conf.high statename               \n     <dbl>    <dbl>    <dbl>     <dbl> <chr>                   \n1   0.0123 2.23e-28  0.00567    0.0264 United States of America\n2   0.0140 2.25e-70  0.00879    0.0222 Venezuela               \n3   0.0286 8.46e-39  0.0170     0.0477 Rwanda                  \n```\n\n\n:::\n:::\n\n\n## Your Turn! \n\n<br>\n\n- Run a multivariate logistic model using conflict onset as the outcome variable\n- Select alternative variables and/or alternative measures of the same variables\n- Interpret some of the coefficients \n- Calculate the precicted probability in a handful of country-years based on your analysis\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"countdown\" id=\"timer1\" data-update-every=\"1\" tabindex=\"0\" style=\"right:10%;bottom:5%;\">\n<div class=\"countdown-controls\"><button class=\"countdown-bump-down\">&minus;</button><button class=\"countdown-bump-up\">&plus;</button></div>\n<code class=\"countdown-time\"><span class=\"countdown-digits minutes\">10</span><span class=\"countdown-digits colon\">:</span><span class=\"countdown-digits seconds\">00</span></code>\n</div>\n```\n\n:::\n:::\n\n\n# Regression Tables\n\n## What's in a Regression Table?\n\n![](images/fearon_laitin.png){fig-align=center}\n\n## Regression Tables with `modelsummary`\n\n<br>\n\n::: {.incremental}\n- Oftentimes we want to show multiple models at once (like F&L)\n- We want to compare across them and see which is the best model\n- How can we do that? \n- There are **many** ways to do this in R\n- We will use the `modelsummary` package\n:::\n\n## Run Multiple Models\n\n<br>\n\n\n::: {.cell}\n\n```{.r .cell-code}\nethnicity <- glm(ucdponset ~ ethfrac + relfrac + wbgdppc2011est + wbpopest, # store each model in an object\n                  data = conflict_df,\n                  family = \"binomial\")\n\ndemocracy <- glm(ucdponset ~ v2x_polyarchy + wbgdppc2011est +  wbpopest,\n                  data = conflict_df,\n                  family = \"binomial\")\n\nterrain <- glm(ucdponset ~ rugged + wbgdppc2011est + wbpopest ,\n                  data = conflict_df,\n                  family = \"binomial\")\n\nfull_model <- glm(ucdponset ~ ethfrac + relfrac + v2x_polyarchy + rugged +\n                        wbgdppc2011est + wbpopest,\n                  data = conflict_df,\n                  family = \"binomial\")\n```\n:::\n\n\n\n## Prep Data for Display\n\n<br>\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodels <- list(\"Ethnicity\" = ethnicity,  # store list of models in an object\n               \"Democracy\" = democracy, \n               \"Terrain\" = terrain, \n               \"Full Model\" = full_model)\n\ncoef_map <- c(\"ethfrac\" = \"Ethnic Frac\",  # map coefficients\n        \"relfrac\" = \"Religions Frac\",     #(change names and order)\n        \"v2x_polyarchy\" = \"Polyarchy\",\n        \"rugged\" = \"Terrain\",\n        \"wbgdppc2011est\" = \"Per capita GDP\",\n        \"wbpopest\" = \"Population\",\n        \"(Intercept)\" = \"Intercept\")\n\ncaption = \"Table 1: Predictors of Conflict Onset\" # store caption\nreference = \"See appendix for data sources.\"      # store reference notes\n```\n:::\n\n\n## Display the Models {.smaller}\n\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table style=\"NAborder-bottom: 0; width: auto !important; margin-left: auto; margin-right: auto;\" class=\"table\">\n<caption>Table 1: Predictors of Conflict Onset</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\">   </th>\n   <th style=\"text-align:center;\"> Ethnicity </th>\n   <th style=\"text-align:center;\"> Democracy </th>\n   <th style=\"text-align:center;\"> Terrain </th>\n   <th style=\"text-align:center;\"> Full Model </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Ethnic Frac </td>\n   <td style=\"text-align:center;\"> 0.744* </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\"> 0.800* </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> (0.367) </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\"> (0.381) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Religions Frac </td>\n   <td style=\"text-align:center;\"> −0.481 </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\"> −0.391 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> (0.411) </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\"> (0.417) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Polyarchy </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\"> −0.228 </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\"> −0.602 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\"> (0.436) </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\"> (0.509) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Terrain </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\"> 0.031 </td>\n   <td style=\"text-align:center;\"> 0.064 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\"> (0.076) </td>\n   <td style=\"text-align:center;\"> (0.076) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Per capita GDP </td>\n   <td style=\"text-align:center;\"> −0.474*** </td>\n   <td style=\"text-align:center;\"> −0.512*** </td>\n   <td style=\"text-align:center;\"> −0.543*** </td>\n   <td style=\"text-align:center;\"> −0.372** </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> (0.104) </td>\n   <td style=\"text-align:center;\"> (0.108) </td>\n   <td style=\"text-align:center;\"> (0.092) </td>\n   <td style=\"text-align:center;\"> (0.121) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Population </td>\n   <td style=\"text-align:center;\"> 0.282*** </td>\n   <td style=\"text-align:center;\"> 0.297*** </td>\n   <td style=\"text-align:center;\"> 0.299*** </td>\n   <td style=\"text-align:center;\"> 0.293*** </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> (0.067) </td>\n   <td style=\"text-align:center;\"> (0.051) </td>\n   <td style=\"text-align:center;\"> (0.050) </td>\n   <td style=\"text-align:center;\"> (0.067) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Intercept </td>\n   <td style=\"text-align:center;\"> −4.703*** </td>\n   <td style=\"text-align:center;\"> −4.407*** </td>\n   <td style=\"text-align:center;\"> −4.296*** </td>\n   <td style=\"text-align:center;\"> −5.693*** </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;box-shadow: 0px 1.5px\">  </td>\n   <td style=\"text-align:center;box-shadow: 0px 1.5px\"> (1.327) </td>\n   <td style=\"text-align:center;box-shadow: 0px 1.5px\"> (1.205) </td>\n   <td style=\"text-align:center;box-shadow: 0px 1.5px\"> (1.143) </td>\n   <td style=\"text-align:center;box-shadow: 0px 1.5px\"> (1.408) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Num.Obs. </td>\n   <td style=\"text-align:center;\"> 6364 </td>\n   <td style=\"text-align:center;\"> 6772 </td>\n   <td style=\"text-align:center;\"> 6840 </td>\n   <td style=\"text-align:center;\"> 6151 </td>\n  </tr>\n</tbody>\n<tfoot>\n<tr><td style=\"padding: 0; \" colspan=\"100%\">\n<sup></sup> + p &lt; 0.1, * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001</td></tr>\n<tr><td style=\"padding: 0; \" colspan=\"100%\">\n<sup></sup> See appendix for data sources.</td></tr>\n</tfoot>\n</table>\n\n`````\n:::\n:::\n\n\n## Your Turn!\n\n<br>\n\n- Got to the [peacesciencer](https://svmiller.com/peacesciencer/reference/index.html) documentation\n- How close are our data to F&L's?\n- Could we change something to better approximate their results? \n- Run multiple models using different predictors\n- Display the models using `modelsummary`\n- Try to get as close to F&L as you can! \n\n\n::: {.cell}\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"countdown\" id=\"timer2\" data-update-every=\"1\" tabindex=\"0\" style=\"right:10%;bottom:5%;\">\n<div class=\"countdown-controls\"><button class=\"countdown-bump-down\">&minus;</button><button class=\"countdown-bump-up\">&plus;</button></div>\n<code class=\"countdown-time\"><span class=\"countdown-digits minutes\">12</span><span class=\"countdown-digits colon\">:</span><span class=\"countdown-digits seconds\">00</span></code>\n</div>\n```\n\n:::\n:::\n\n\n# Coefficient Plots\n\n## {.smaller}\n\n<br> \n\nThis don't look too good...\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nmodelsummary(conflict_model, \n             stars = TRUE,  \n             gof_map = c(\"nobs\"),\n             coef_map = coef_map,\n             title = caption, \n             notes = reference)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table style=\"NAborder-bottom: 0; width: auto !important; margin-left: auto; margin-right: auto;\" class=\"table\">\n<caption>Table 1: Predictors of Conflict Onset</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\">   </th>\n   <th style=\"text-align:center;\">  (1) </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Ethnic Frac </td>\n   <td style=\"text-align:center;\"> 0.800* </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> (0.381) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Religions Frac </td>\n   <td style=\"text-align:center;\"> −0.391 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> (0.417) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Polyarchy </td>\n   <td style=\"text-align:center;\"> −0.602 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> (0.509) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Terrain </td>\n   <td style=\"text-align:center;\"> 0.064 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> (0.076) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Per capita GDP </td>\n   <td style=\"text-align:center;\"> −0.372** </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> (0.121) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Population </td>\n   <td style=\"text-align:center;\"> 0.293*** </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> (0.067) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Intercept </td>\n   <td style=\"text-align:center;\"> −5.693*** </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;box-shadow: 0px 1.5px\">  </td>\n   <td style=\"text-align:center;box-shadow: 0px 1.5px\"> (1.408) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Num.Obs. </td>\n   <td style=\"text-align:center;\"> 6151 </td>\n  </tr>\n</tbody>\n<tfoot>\n<tr><td style=\"padding: 0; \" colspan=\"100%\">\n<sup></sup> + p &lt; 0.1, * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001</td></tr>\n<tr><td style=\"padding: 0; \" colspan=\"100%\">\n<sup></sup> See appendix for data sources.</td></tr>\n</tfoot>\n</table>\n\n`````\n:::\n:::\n\n\n## \n\n<br> \n\nSo we can use `ggplot` to make a coefficient plot instead...\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nlibrary(ggplot2)\n\nmodelplot(conflict_model, \n          coef_map = rev(coef_map), # rev() reverses list order\n          coef_omit = \"Intercept\", \n          color = \"blue\") + # use plus to add customizations like any ggplot object\n  geom_vline(xintercept = 0, color = \"red\", linetype = \"dashed\", linewidth = .75) + # red 0 line\n  labs(\n    title = \"Figure 1: Predictors of Conflict Onset\",\n    caption = \"See appendix for data sources.\"\n  ) \n```\n\n::: {.cell-output-display}\n![](week-11.2_files/figure-revealjs/coef_plot-1.png){width=960}\n:::\n:::\n\n\n## Your Turn!\n\n- Take one of your models\n- Use `modelplot` to create a coefficient plot of it\n- Customize the plot to your liking\n- Interpret the results\n- Discuss advantages of coefficient plots with a neighbor\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"countdown\" id=\"timer3\" data-update-every=\"1\" tabindex=\"0\" style=\"right:10%;bottom:5%;\">\n<div class=\"countdown-controls\"><button class=\"countdown-bump-down\">&minus;</button><button class=\"countdown-bump-up\">&plus;</button></div>\n<code class=\"countdown-time\"><span class=\"countdown-digits minutes\">12</span><span class=\"countdown-digits colon\">:</span><span class=\"countdown-digits seconds\">00</span></code>\n</div>\n```\n\n:::\n:::\n",
    "supporting": [
      "week-11.2_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../site_libs/countdown-0.4.0/countdown.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/countdown-0.4.0/countdown.js\"></script>\n<script src=\"../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ],
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}